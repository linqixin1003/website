#!/usr/bin/env python3
import os
import re
from pathlib import Path

def create_german_translation_dict():
    """创建英语到德语的翻译词典"""
    return {
        # 基础词汇
        'the': 'der/die/das',
        'and': 'und',
        'or': 'oder',
        'but': 'aber',
        'with': 'mit',
        'from': 'von',
        'this': 'dieser/diese/dieses',
        'that': 'jener/jene/jenes',
        'these': 'diese',
        'those': 'jene',
        'are': 'sind',
        'is': 'ist',
        'was': 'war',
        'were': 'waren',
        'have': 'haben',
        'has': 'hat',
        'had': 'hatte',
        'will': 'wird',
        'would': 'würde',
        'could': 'könnte',
        'should': 'sollte',
        'may': 'kann',
        'might': 'könnte',
        'can': 'kann',
        'must': 'muss',
        'shall': 'soll',
        'do': 'tun',
        'does': 'tut',
        'did': 'tat',
        'get': 'bekommen',
        'got': 'bekam',
        'make': 'machen',
        'made': 'machte',
        'take': 'nehmen',
        'took': 'nahm',
        'come': 'kommen',
        'came': 'kam',
        'go': 'gehen',
        'went': 'ging',
        'see': 'sehen',
        'saw': 'sah',
        'know': 'wissen',
        'knew': 'wusste',
        'think': 'denken',
        'thought': 'dachte',
        'say': 'sagen',
        'said': 'sagte',
        'tell': 'erzählen',
        'told': 'erzählte',
        'give': 'geben',
        'gave': 'gab',
        'find': 'finden',
        'found': 'fand',
        'work': 'arbeiten',
        'worked': 'arbeitete',
        'call': 'rufen',
        'called': 'rief',
        'try': 'versuchen',
        'tried': 'versuchte',
        'ask': 'fragen',
        'asked': 'fragte',
        'need': 'brauchen',
        'needed': 'brauchte',
        'feel': 'fühlen',
        'felt': 'fühlte',
        'become': 'werden',
        'became': 'wurde',
        'leave': 'verlassen',
        'left': 'verließ',
        'put': 'setzen',
        'mean': 'bedeuten',
        'meant': 'bedeutete',
        'keep': 'behalten',
        'kept': 'behielt',
        'let': 'lassen',
        'begin': 'beginnen',
        'began': 'begann',
        'seem': 'scheinen',
        'seemed': 'schien',
        'help': 'helfen',
        'helped': 'half',
        'talk': 'sprechen',
        'talked': 'sprach',
        'turn': 'drehen',
        'turned': 'drehte',
        'start': 'beginnen',
        'started': 'begann',
        'show': 'zeigen',
        'showed': 'zeigte',
        'hear': 'hören',
        'heard': 'hörte',
        'play': 'spielen',
        'played': 'spielte',
        'run': 'laufen',
        'ran': 'lief',
        'move': 'bewegen',
        'moved': 'bewegte',
        'live': 'leben',
        'lived': 'lebte',
        'believe': 'glauben',
        'believed': 'glaubte',
        'hold': 'halten',
        'held': 'hielt',
        'bring': 'bringen',
        'brought': 'brachte',
        'happen': 'geschehen',
        'happened': 'geschah',
        'write': 'schreiben',
        'wrote': 'schrieb',
        'provide': 'bereitstellen',
        'provided': 'stellte bereit',
        'sit': 'sitzen',
        'sat': 'saß',
        'stand': 'stehen',
        'stood': 'stand',
        'lose': 'verlieren',
        'lost': 'verlor',
        'pay': 'bezahlen',
        'paid': 'bezahlte',
        'meet': 'treffen',
        'met': 'traf',
        'include': 'einschließen',
        'included': 'schloss ein',
        'continue': 'fortsetzen',
        'continued': 'setzte fort',
        'set': 'setzen',
        'learn': 'lernen',
        'learned': 'lernte',
        'change': 'ändern',
        'changed': 'änderte',
        'lead': 'führen',
        'led': 'führte',
        'understand': 'verstehen',
        'understood': 'verstand',
        'watch': 'beobachten',
        'watched': 'beobachtete',
        'follow': 'folgen',
        'followed': 'folgte',
        'stop': 'stoppen',
        'stopped': 'stoppte',
        'create': 'schaffen',
        'created': 'schuf',
        'speak': 'sprechen',
        'spoke': 'sprach',
        'read': 'lesen',
        'allow': 'erlauben',
        'allowed': 'erlaubte',
        'add': 'hinzufügen',
        'added': 'fügte hinzu',
        'spend': 'verbringen',
        'spent': 'verbrachte',
        'grow': 'wachsen',
        'grew': 'wuchs',
        'open': 'öffnen',
        'opened': 'öffnete',
        'walk': 'gehen',
        'walked': 'ging',
        'win': 'gewinnen',
        'won': 'gewann',
        'offer': 'anbieten',
        'offered': 'bot an',
        'remember': 'erinnern',
        'remembered': 'erinnerte',
        'love': 'lieben',
        'loved': 'liebte',
        'consider': 'betrachten',
        'considered': 'betrachtete',
        'appear': 'erscheinen',
        'appeared': 'erschien',
        'buy': 'kaufen',
        'bought': 'kaufte',
        'wait': 'warten',
        'waited': 'wartete',
        'serve': 'dienen',
        'served': 'diente',
        'die': 'sterben',
        'died': 'starb',
        'send': 'senden',
        'sent': 'sendete',
        'expect': 'erwarten',
        'expected': 'erwartete',
        'build': 'bauen',
        'built': 'baute',
        'stay': 'bleiben',
        'stayed': 'blieb',
        'fall': 'fallen',
        'fell': 'fiel',
        'cut': 'schneiden',
        'reach': 'erreichen',
        'reached': 'erreichte',
        'kill': 'töten',
        'killed': 'tötete',
        'remain': 'bleiben',
        'remained': 'blieb',
        'suggest': 'vorschlagen',
        'suggested': 'schlug vor',
        'raise': 'erheben',
        'raised': 'erhob',
        'pass': 'passieren',
        'passed': 'passierte',
        'sell': 'verkaufen',
        'sold': 'verkaufte',
        'require': 'erfordern',
        'required': 'erforderte',
        'report': 'berichten',
        'reported': 'berichtete',
        'decide': 'entscheiden',
        'decided': 'entschied',
        'pull': 'ziehen',
        'pulled': 'zog',
        
        # 鸟类学专业词汇
        'bird': 'Vogel',
        'birds': 'Vögel',
        'avian': 'Vogel-',
        'ornithology': 'Ornithologie',
        'ornithological': 'ornithologisch',
        'species': 'Art',
        'feather': 'Feder',
        'feathers': 'Federn',
        'wing': 'Flügel',
        'wings': 'Flügel',
        'flight': 'Flug',
        'flying': 'fliegend',
        'song': 'Gesang',
        'songs': 'Gesänge',
        'call': 'Ruf',
        'calls': 'Rufe',
        'nest': 'Nest',
        'nests': 'Nester',
        'nesting': 'Nisten',
        'egg': 'Ei',
        'eggs': 'Eier',
        'chick': 'Küken',
        'chicks': 'Küken',
        'juvenile': 'Jungvogel',
        'juveniles': 'Jungvögel',
        'adult': 'erwachsen',
        'adults': 'Erwachsene',
        'male': 'Männchen',
        'males': 'Männchen',
        'female': 'Weibchen',
        'females': 'Weibchen',
        'territory': 'Territorium',
        'territories': 'Territorien',
        'mating': 'Paarung',
        'breeding': 'Brut',
        'reproduction': 'Fortpflanzung',
        'reproductive': 'fortpflanzungsbezogen',
        'migration': 'Migration',
        'migratory': 'wandernd',
        'resident': 'standorttreu',
        'seasonal': 'saisonbedingt',
        'seasons': 'Jahreszeiten',
        'winter': 'Winter',
        'spring': 'Frühling',
        'summer': 'Sommer',
        'autumn': 'Herbst',
        'fall': 'Herbst',
        'climate': 'Klima',
        'weather': 'Wetter',
        'temperature': 'Temperatur',
        'temperatures': 'Temperaturen',
        'food': 'Nahrung',
        'feeding': 'Fütterung',
        'diet': 'Ernährung',
        'nutrition': 'Ernährung',
        'nutritional': 'ernährungsbedingt',
        'hunting': 'Jagd',
        'hunt': 'jagen',
        'hunted': 'gejagt',
        'foraging': 'Nahrungssuche',
        'water': 'Wasser',
        'aquatic': 'aquatisch',
        'terrestrial': 'terrestrisch',
        'arboreal': 'baumbewohnend',
        'nocturnal': 'nachtaktiv',
        'diurnal': 'tagaktiv',
        'endemic': 'endemisch',
        'native': 'einheimisch',
        'introduced': 'eingeführt',
        'invasive': 'invasiv',
        'threatened': 'bedroht',
        'endangered': 'gefährdet',
        'extinct': 'ausgestorben',
        'protection': 'Schutz',
        'protect': 'schützen',
        'protected': 'geschützt',
        'preserve': 'bewahren',
        'preservation': 'Bewahrung',
        'restore': 'wiederherstellen',
        'restoration': 'Wiederherstellung',
        'conservation': 'Naturschutz',
        'manage': 'verwalten',
        'management': 'Verwaltung',
        'monitor': 'überwachen',
        'monitoring': 'Überwachung',
        'survey': 'Untersuchung',
        'surveys': 'Untersuchungen',
        'count': 'zählen',
        'counting': 'Zählung',
        'census': 'Zensus',
        'distribution': 'Verbreitung',
        'range': 'Verbreitungsgebiet',
        'ranges': 'Verbreitungsgebiete',
        'abundance': 'Häufigkeit',
        'density': 'Dichte',
        'rarity': 'Seltenheit',
        'common': 'häufig',
        'uncommon': 'ungewöhnlich',
        'rare': 'selten',
        'frequent': 'häufig',
        'occasional': 'gelegentlich',
        'regular': 'regelmäßig',
        'irregular': 'unregelmäßig',
        'stable': 'stabil',
        'declining': 'abnehmend',
        'increasing': 'zunehmend',
        'fluctuating': 'schwankend',
        
        # 生态学词汇
        'ecosystem': 'Ökosystem',
        'ecosystems': 'Ökosysteme',
        'habitat': 'Lebensraum',
        'habitats': 'Lebensräume',
        'biodiversity': 'Biodiversität',
        'environmental': 'umweltbedingt',
        'ecological': 'ökologisch',
        'natural': 'natürlich',
        'wildlife': 'Tierwelt',
        'population': 'Population',
        'populations': 'Populationen',
        'community': 'Gemeinschaft',
        'communities': 'Gemeinschaften',
        'behavior': 'Verhalten',
        'behaviors': 'Verhaltensweisen',
        'adaptation': 'Anpassung',
        'adaptations': 'Anpassungen',
        'evolution': 'Evolution',
        'evolutionary': 'evolutionär',
        'genetic': 'genetisch',
        'genetics': 'Genetik',
        'physiology': 'Physiologie',
        'physiological': 'physiologisch',
        'anatomy': 'Anatomie',
        'anatomical': 'anatomisch',
        'morphology': 'Morphologie',
        'morphological': 'morphologisch',
        'taxonomy': 'Taxonomie',
        'taxonomic': 'taxonomisch',
        'classification': 'Klassifikation',
        'identify': 'identifizieren',
        'identification': 'Identifikation',
        'observe': 'beobachten',
        'observation': 'Beobachtung',
        'research': 'Forschung',
        'study': 'Studie',
        'studies': 'Studien',
        'analysis': 'Analyse',
        'data': 'Daten',
        'information': 'Information',
        'knowledge': 'Wissen',
        'science': 'Wissenschaft',
        'scientific': 'wissenschaftlich',
        'biology': 'Biologie',
        'biological': 'biologisch',
        
        # 地理和栖息地词汇
        'forest': 'Wald',
        'forests': 'Wälder',
        'woodland': 'Waldland',
        'woodlands': 'Waldländer',
        'grassland': 'Grasland',
        'grasslands': 'Grasländer',
        'wetland': 'Feuchtgebiet',
        'wetlands': 'Feuchtgebiete',
        'desert': 'Wüste',
        'deserts': 'Wüsten',
        'mountain': 'Berg',
        'mountains': 'Berge',
        'coastal': 'Küsten-',
        'marine': 'Meeres-',
        'freshwater': 'Süßwasser',
        'saltwater': 'Salzwasser',
        'river': 'Fluss',
        'rivers': 'Flüsse',
        'lake': 'See',
        'lakes': 'Seen',
        'pond': 'Teich',
        'ponds': 'Teiche',
        'stream': 'Bach',
        'streams': 'Bäche',
        'ocean': 'Ozean',
        'oceans': 'Ozeane',
        'sea': 'Meer',
        'seas': 'Meere',
        'island': 'Insel',
        'islands': 'Inseln',
        'continent': 'Kontinent',
        'continents': 'Kontinente',
        'tropical': 'tropisch',
        'temperate': 'gemäßigt',
        'arctic': 'arktisch',
        'alpine': 'alpin',
        'urban': 'städtisch',
        'suburban': 'vorstädtisch',
        'rural': 'ländlich',
        'agricultural': 'landwirtschaftlich',
        'farmland': 'Ackerland',
        'park': 'Park',
        'parks': 'Parks',
        'garden': 'Garten',
        'gardens': 'Gärten',
        'reserve': 'Reservat',
        'reserves': 'Reservate',
        'sanctuary': 'Schutzgebiet',
        'sanctuaries': 'Schutzgebiete',
        'refuge': 'Zuflucht',
        'refuges': 'Zufluchten',
        'national': 'national',
        'international': 'international',
        'global': 'global',
        'local': 'lokal',
        'regional': 'regional',
        'area': 'Gebiet',
        'areas': 'Gebiete',
        'zone': 'Zone',
        'zones': 'Zonen',
        'site': 'Standort',
        'sites': 'Standorte',
        'location': 'Ort',
        'locations': 'Orte',
        'place': 'Platz',
        'places': 'Plätze',
        'region': 'Region',
        'regions': 'Regionen',
        'country': 'Land',
        'countries': 'Länder',
        'state': 'Staat',
        'states': 'Staaten',
        'province': 'Provinz',
        'provinces': 'Provinzen',
        'city': 'Stadt',
        'cities': 'Städte',
        'town': 'Stadt',
        'towns': 'Städte',
        'village': 'Dorf',
        'villages': 'Dörfer',
        
        # 其他常用词汇
        'primary': 'primär',
        'secondary': 'sekundär',
        'tertiary': 'tertiär',
        'consumers': 'Verbraucher',
        'producers': 'Produzenten',
        'predators': 'Raubtiere',
        'prey': 'Beute'
    }

def fix_german_content(content, translation_dict):
    """修复德语内容中的英语单词"""
    
    # 保护HTML标签和属性
    protected_content = content
    
    # 逐个替换英语单词
    for english, german in translation_dict.items():
        # 使用单词边界匹配，避免替换部分单词
        pattern = r'\b' + re.escape(english) + r'\b'
        
        # 区分大小写替换
        protected_content = re.sub(pattern, german, protected_content, flags=re.IGNORECASE)
        
        # 处理首字母大写的情况
        if english[0].islower():
            capitalized_english = english.capitalize()
            capitalized_german = german.capitalize() if german and german[0].islower() else german
            pattern_cap = r'\b' + re.escape(capitalized_english) + r'\b'
            protected_content = re.sub(pattern_cap, capitalized_german, protected_content)
    
    return protected_content

def translate_german_articles():
    """翻译德语文章中的英语内容"""
    
    de_dir = Path('de')
    if not de_dir.exists():
        print("德语目录不存在")
        return
    
    translation_dict = create_german_translation_dict()
    modified_files = []
    
    print("开始修复德语文章中的英语内容...")
    
    for html_file in de_dir.rglob('*.html'):
        try:
            with open(html_file, 'r', encoding='utf-8') as f:
                content = f.read()
            
            original_content = content
            
            # 修复英语内容
            fixed_content = fix_german_content(content, translation_dict)
            
            if fixed_content != original_content:
                with open(html_file, 'w', encoding='utf-8') as f:
                    f.write(fixed_content)
                
                modified_files.append(str(html_file))
                print(f"✅ 已修复: {html_file}")
            else:
                print(f"⚪ 无需修复: {html_file}")
                
        except Exception as e:
            print(f"❌ 处理文件 {html_file} 时出错: {e}")
    
    print(f"\n=== 德语翻译修复完成 ===")
    print(f"共修复了 {len(modified_files)} 个文件")
    
    return modified_files

if __name__ == "__main__":
    translate_german_articles()