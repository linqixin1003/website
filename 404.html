<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>重定向中...</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f5f5f5;
        }
        .redirect-container {
            text-align: center;
            padding: 2rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error-message {
            display: none;
        }
    </style>
</head>
<body>
    <div class="redirect-container">
        <div class="spinner" id="spinner"></div>
        <h2 id="status">正在重定向...</h2>
        <p id="message">请稍候，正在跳转到正确的页面...</p>
        <div class="error-message" id="errorMessage">
            <p>如果页面没有自动跳转，请<a href="/" id="manualLink">点击这里返回首页</a></p>
        </div>
    </div>

    <script>
        // 防止无限循环的重定向处理
        function handleRedirect() {
            const currentPath = window.location.pathname;
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            
            console.log('当前路径:', currentPath);
            console.log('语言参数:', lang);
            
            // 检查是否已经是语言子目录格式，如果是则不重定向
            if (currentPath.match(/^\/[a-z]{2}\//)) {
                console.log('已经是语言子目录格式，不需要重定向');
                showError();
                return;
            }
            
            // 如果有语言参数，进行重定向
            if (lang && lang.length === 2) {
                let newUrl = '';
                
                // 定义重定向规则
                if (currentPath.match(/^\/knowledge\/(.+)\.html$/)) {
                    const fileName = currentPath.match(/^\/knowledge\/(.+)\.html$/)[1];
                    newUrl = `/${lang}/knowledge/${fileName}.html`;
                } else if (currentPath.match(/^\/birdwatching\/(.+)\.html$/)) {
                    const fileName = currentPath.match(/^\/birdwatching\/(.+)\.html$/)[1];
                    newUrl = `/${lang}/birdwatching/${fileName}.html`;
                } else if (currentPath.match(/^\/pet-care\/(.+)\.html$/)) {
                    const fileName = currentPath.match(/^\/pet-care\/(.+)\.html$/)[1];
                    newUrl = `/${lang}/pet-care/${fileName}.html`;
                } else if (currentPath.match(/^\/ecology\/(.+)\.html$/)) {
                    const fileName = currentPath.match(/^\/ecology\/(.+)\.html$/)[1];
                    newUrl = `/${lang}/ecology/${fileName}.html`;
                } else if (currentPath.match(/^\/scientific-wonders\/(.+)\.html$/)) {
                    const fileName = currentPath.match(/^\/scientific-wonders\/(.+)\.html$/)[1];
                    newUrl = `/${lang}/scientific-wonders/${fileName}.html`;
                } else if (currentPath === '/knowledge.html') {
                    newUrl = `/${lang}/knowledge.html`;
                } else if (currentPath === '/birdwatching.html') {
                    newUrl = `/${lang}/birdwatching.html`;
                } else if (currentPath === '/pet-care.html') {
                    newUrl = `/${lang}/pet-care.html`;
                } else if (currentPath === '/ecology.html') {
                    newUrl = `/${lang}/ecology.html`;
                } else if (currentPath === '/scientific-wonders.html') {
                    newUrl = `/${lang}/scientific-wonders.html`;
                }
                
                if (newUrl) {
                    console.log(`重定向: ${currentPath}?lang=${lang} -> ${newUrl}`);
                    
                    // 更新手动链接
                    document.getElementById('manualLink').href = newUrl;
                    document.getElementById('manualLink').textContent = '点击这里手动跳转';
                    
                    // 立即执行重定向
                    window.location.href = newUrl;
                    return;
                }
            }
            
            // 如果没有匹配的重定向规则，显示404信息
            showError();
        }
        
        function showError() {
            document.getElementById('spinner').style.display = 'none';
            document.getElementById('status').textContent = '页面未找到';
            document.getElementById('message').textContent = '请检查URL是否正确';
            document.getElementById('errorMessage').style.display = 'block';
        }
        
        // 页面加载时执行重定向检查
        document.addEventListener('DOMContentLoaded', function() {
            // 延迟执行，确保页面完全加载
            setTimeout(handleRedirect, 500);
        });
    </script>
</body>
</html>